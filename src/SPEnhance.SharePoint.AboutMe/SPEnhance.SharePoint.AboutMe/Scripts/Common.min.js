function getFieldsByListName(n){var t="";return $.each(listNames.lists,function(i,r){if(r.listName==n)return $.each(r.fields,function(n,i){t+=i.fieldInternalName+","}),!1}),t.substring(0,t.lastIndexOf(","))}function getListMaxRows(n){var t=-1;return $.each(listNames.lists,function(i,r){if(r.listName==n&&r.maxRows!=null)return console.log(r.listName+" "+r.maxRows),t=r.maxRows,!1}),t}function getFieldTypeByListFieldInternalName(n,t){var i="";return $.each(listNames.lists,function(r,u){if(u.listName==n)return console.log(u.listName+" "+JSON.stringify(u.fields)),$.each(u.fields,function(n,r){return console.log(r.fieldType),r.fieldInternalName==t?(i=r.fieldType,!1):void 0}),console.log(i),!1}),i}function getFieldDisplayNameByListFieldInternalName(n,t){var i="";return $.each(listNames.lists,function(r,u){if(u.listName==n)return console.log(u.listName+" "+JSON.stringify(u.fields)),$.each(u.fields,function(n,r){return console.log(r.fieldType),r.fieldInternalName==t?(i=r.fieldDisplayName,!1):void 0}),console.log(i),!1}),i}function showMsg(n){$("#spanMsg").text().length>0?$("#spanMsg").html($("#spanMsg").html()+"<br/>"+n):$("#spanMsg").html(n);$("#divMsg").show()}function clearMsg(){$("#spanMsg").html("");$("#divMsg").hide()}function getQueryStringParameter(n){for(var i,r=document.URL.split("?")[1].split("&"),t=0;t<r.length;t=t+1)if(i=r[t].split("="),i[0]==n)return i[1]}function refreshPage(){window.location.reload(!0)}function createSingleList(n,t){$.each(listNames.lists,function(i,r){if(r.listName==n){createList(clientContext,n,r.fields,t);return}})}function createList(n,t,i,r){function e(){r&&showMsg("List "+t+" created.");console.log("List "+t+" created.");createListFields(n,f,i,r)}function o(n,i){r&&showMsg("Failed to create list "+t+". Error:"+i.get_message());console.log("Failed to create list "+t+". Error:"+i.get_message())}var u=new SP.ListCreationInformation,f;u.set_title(t);u.set_templateType(SP.ListTemplateType.genericList);f=webLists.add(u);n.load(f);n.executeQueryAsync(e,o)}function createListFields(n,t,i,r){function o(){console.log("Fields created in List "+t.get_title());r?(showMsg("Fields created in List "+t.get_title()),displayAllLists(n)):(t.get_title()==overviewListName&&objClient.getListData(overviewListName,getFieldsByListName(overviewListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><RowLimit>1<\/RowLimit><\/View>",callbackOverviewSuccess,callbackFail),t.get_title()==personalInfoListName&&objClient.getListData(personalInfoListName,getFieldsByListName(personalInfoListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><RowLimit>1<\/RowLimit><\/View>",callbackPersonalInfoSuccess,callbackFail),t.get_title()==skillListName&&objClient.getListData(skillListName,getFieldsByListName(skillListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackSkillSuccess,callbackFail),t.get_title()==certificationListName&&objClient.getListData(certificationListName,getFieldsByListName(certificationListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackCertificationSuccess,callbackFail),t.get_title()==projectListName&&objClient.getListData(projectListName,getFieldsByListName(projectListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackProjectSuccess,callbackFail),t.get_title()==experienceListName&&objClient.getListData(experienceListName,getFieldsByListName(experienceListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackExperienceSuccess,callbackFail),t.get_title()==educationListName&&objClient.getListData(educationListName,getFieldsByListName(educationListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackEducationSuccess,callbackFail))}function s(n,i){r&&showMsg("Failed to create fields in list "+t.get_title()+". Error:"+i.get_message());console.log("Failed to create fields in list "+t.get_title()+". Error:"+i.get_message())}for(var e,f="",u=0;u<i.length;u++)jQuery.inArray(i[u].fieldInternalName,excludeListFieldsToCreate)>=0||(f="<Field  Name='"+i[u].fieldInternalName+"' StaticName='"+i[u].fieldInternalName+"' DisplayName='"+i[u].fieldDisplayName+"' Type='"+i[u].fieldType+"'",(i[u].fieldFormat!=null||i[u].fieldFormat!="undefined")&&(f+=" Format='"+i[u].fieldFormat+"'"),i[u].fieldType=="Note"&&(f+=" NumLines='"+i[u].numLines+"'",f+=" RichText='"+i[u].richText+"'",f+=" Sortable='"+i[u].sortable+"'"),f+=" />",e=t.get_fields().addFieldAsXml(f,!0,SP.AddFieldOptions.addToDefaultContentType|SP.AddFieldOptions.addFieldInternalNameHint|SP.AddFieldOptions.addFieldToDefaultView),e.update());n.executeQueryAsync(o,s)}function displayAllLists(n){function t(){for(var r=webLists.getEnumerator(),i,u=[],f=0,n,t;r.moveNext();)(i=r.get_current(),jQuery.inArray(i.get_title(),excludeListNames)>=0)||(u[f++]=i.get_title());for(n="<ul class='list-group'>",t=0;t<listNames.lists.length;t++)n+="<li class='list-group-item'>",n+=listNames.lists[t].listName,n+="<span style='float:right'>",jQuery.inArray(listNames.lists[t].listName,u)>=0?(n+="<a class='deleteSingleList' data='"+listNames.lists[t].listName+"'>Delete<\/a>",n+=" | ",n+="<a href='"+appWebUrl+"/Pages/Admin/List/View.aspx?listName="+listNames.lists[t].listName+"&SPAppWebUrl="+appWebUrl+"&SPHostUrl="+hostWebUrl+"'>Manage Data<\/a>"):n+="<a class='createSingleList' data='"+listNames.lists[t].listName+"'>Create<\/a>",n+="<\/span>",n+="<\/li>";n+="<\/ul>";$("#lists").html(n);refreshDynamicEventListener()}function i(n,t){showMsg("Error in getting lists. Error is "+t.get_message())}n.load(webLists);n.executeQueryAsync(t,i)}function refreshDynamicEventListener(){$(".createSingleList").off();$(".createSingleList").on("click",function(){clearMsg();createSingleList($(this).attr("data"),!0)});$(".deleteSingleList").off();$(".deleteSingleList").on("click",function(){clearMsg();confirm("Are you sure you want to delete?")&&deleteSingleList($(this).attr("data"))});$(".deleteItem").off();$(".deleteItem").on("click",function(){clearMsg();confirm("Are you sure you want to delete?")&&objClient.deleteListData(listName,$(this).attr("data"),callbackDeleteItemSuccess,callbackDeleteItemFail)})}function deleteSingleList(n){$.each(listNames.lists,function(t,i){if(i.listName==n){deleteList(clientContext,n);return}})}function deleteList(n,t){function i(){function f(){refreshPage()}function e(n,i){showMsg("Failed to delete list "+t+". Error:"+i.get_message())}for(var r=!1,u=webLists.getEnumerator(),i;u.moveNext();)if(i=u.get_current(),i.get_title()==t){r=!0;break}r?(i.deleteObject(),n.executeQueryAsync(f,e)):showMsg("List "+t+" doesn't exist")}function r(n,t){showMsg("Failed to query lists. Error:"+t.get_message())}n.load(webLists);n.executeQueryAsync(i,r)}function deleteAllLists(n){$.each(listNames.lists,function(t,i){var r=webLists.getByTitle(i.listName);r.deleteObject();n.executeQueryAsync(function(){showMsg("List "+i.listName+" deleted.");deletedListCounter++;deletedListCounter==listNames.lists.length&&refreshPage()},function(n,t){showMsg("Failed to delete list "+i.listName+". Error:"+t.get_message())})})}function callbackFail(n,t){n.indexOf("List '"+t+"' does not exist at site with URL")==0?createSingleList(t,!1):showMsg(n)}function callbackOverviewSuccess(n,t,i){n.length==1?($(".short-overview").text(n[0].Title),$(".long-overview").text(n[0].LongOverview)):($(".short-overview").html('<a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a>'),$(".long-overview").html('<a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a>'));objClient.getListData(personalInfoListName,getFieldsByListName(personalInfoListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><RowLimit>1<\/RowLimit><\/View>",callbackPersonalInfoSuccess,callbackFail)}function callbackPersonalInfoSuccess(n,t,i){n.length==1?($("#address").text(n[0].Title),$("#email").html(n[0].Email),$("#phone").html(n[0].Phone)):($("#address").html('<a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a>'),$("#email").html('<a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a>'),$("#phone").html('<a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a>'));objClient.getListData(skillListName,getFieldsByListName(skillListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackSkillSuccess,callbackFail)}function callbackSkillSuccess(n,t,i){var r='<tr><td><a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a><\/td><\/tr>',u,f;if(n.length>0)for(r="",u=0;u<n.length;u++)f=0,r+="<tr>",r+="<td class='skill'>"+n[u].Title+"<\/td>",r+="<td>"+n[u].Experience+"<\/td>",r+="<\/tr>";$("#skill").html(r);objClient.getListData(certificationListName,getFieldsByListName(certificationListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackCertificationSuccess,callbackFail)}function callbackCertificationSuccess(n,t,i){var r='<tr><td><a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a><\/td><\/tr>',u,f;if(n.length>0)for(r="",u=0;u<n.length;u++)f=0,r+="<tr>",r+="<td class='skill'>"+n[u].Title+"<\/td>",r+="<td>"+n[u].Completed+"<\/td>",r+="<\/tr>";$("#certification").html(r);objClient.getListData(experienceListName,getFieldsByListName(experienceListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackExperienceSuccess,callbackFail)}function callbackExperienceSuccess(n,t,i){var r='<tr><td><a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a><\/td><\/tr>',u,f;if(n.length>0)for(r="",u=0;u<n.length;u++)f=0,r+="<tr>",r+="<td>"+n[u].Title+"<\/td>",r+="<td>"+n[u].Company.description+"<\/td>",r+="<td>"+n[u].Company.url+"<\/td>",r+="<\/tr>";$("#experience").html(r);objClient.getListData(educationListName,getFieldsByListName(educationListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackEducationSuccess,callbackFail)}function callbackEducationSuccess(n,t,i){var r='<tr><td><a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a><\/td><\/tr>',u,f;if(n.length>0)for(r="",u=0;u<n.length;u++)f=0,r+="<tr>",r+="<td class='education'>"+n[u].Title+"<\/td>",r+="<td>"+n[u].University.description+"<\/td>",r+="<td>"+n[u].University.url+"<\/td>",r+="<td>"+n[u].Completed+"<\/td>",r+="<\/tr>";$("#education").html(r);objClient.getListData(projectListName,getFieldsByListName(projectListName),"<View><Query><Where><Eq><FieldRef Name='Author'/><Value Type='Integer'><UserID/><\/Value><\/Eq><\/Where><\/Query><\/View>",callbackProjectSuccess,callbackFail)}function callbackProjectSuccess(n,t,i){var u='<tr><td><a name="add" class="no-print" href="'+document.URL.replace("/Pages/Default.aspx?","/Pages/Admin/List/new.aspx?listName="+i+"&")+'">Add<\/a><\/td><\/tr>',r,f;if(n.length>0)for(u="",r=0;r<n.length;r++)f=0,u+="<div class='project-single-height'>",u+="<div class='row'><div class='col-xs-12 col-md-5 project'>"+n[r].Title+"<\/div><div class='col-xs-12 col-md-7 project-version'>"+n[r].Tags+"<\/div><\/div><hr class='hrLine'/>"+n[r].Description,u+="<\/div>";$("#project").html(u)}function setCookie(n,t){document.cookie=n+"="+t}function getCookie(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return""}function getClientContext(n){return $.isNullOrEmpty(n)?new SP.ClientContext.get_current:new SP.ClientContext(n)}function updateUrl(n){$("#"+n).val($("#"+n+"_url").val()+", "+$("#"+n+"_description").val())}$(document).ready(function(){$(".footer-menu").html('<a class="pointerCursor" id="refresh">Refresh<\/a> | <a class="pointerCursor" id="adminHome">Admin Home<\/a> | <a class="pointerCursor" id="print">Print<\/a> | <a class="pointerCursor" href="https://spenhance.codeplex.com/discussions" target="_blank">Technical Support<\/a>');$(".footer-menu-admin").html('<a class="pointerCursor" id="refresh">Refresh<\/a> | <a class="pointerCursor" id="viewResume">View Resume<\/a> | <a class="pointerCursor" id="adminHome">Admin Home<\/a> | <a class="pointerCursor" href="https://spenhance.codeplex.com/discussions" target="_blank">Technical Support<\/a>');$("#refresh").click(function(){refreshPage()});$("#viewResume").attr("href",appWebUrl+"/Pages/Default.aspx?SPAppWebUrl="+appWebUrl+"&SPHostUrl="+hostWebUrl);$("#adminHome").attr("href",appWebUrl+"/Pages/Admin/Default.aspx?SPAppWebUrl="+appWebUrl+"&SPHostUrl="+hostWebUrl);$("#backToSharePoint").click(function(){document.location=decodeURIComponent(getQueryStringParameter("SPHostUrl"))})})